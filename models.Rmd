---

author: "Ivan Kostine, Charl√®ne Khairallah, Niccolo Cherubini"
date: "2023-11-18"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

```



# for each commo: open interest sugar ~ delta price sugar t + delta price sugar t_1 + open interest t_1 + other variables t_1

```{r SUGAR LM}
#SUGAR lm
# Load necessary libraries
library(tidyverse)

# Read the data
sugar_data <- sugar_price_cot

# Selecting predictor variables
predictor_columns_sugar <- names(sugar_data)[grepl(".t_1", names(sugar_data))]
predictor_columns_sugar <- setdiff(predictor_columns_sugar, c("Cotton.t_1", "Cocoa.t_1", "Coffee.t_1", "Cotton.t", "Cocoa.t", "Coffee.t"))
predictor_columns_sugar <- c(predictor_columns_sugar, "Sugar.t", "Sugar.t_1", "Open_Interest.t_1")

# Ensure all predictor columns are numeric
sugar_data <- sugar_data %>% select(all_of(c("Open_Interest.t", predictor_columns_sugar)))
sugar_data <- sugar_data %>% select_if(~is.numeric(.))

# Splitting the dataset in 0.7 train - 0.3 test
set.seed(42) # for reproducibility
train_indices <- sample(1:nrow(sugar_data), size = 0.7 * nrow(sugar_data))
train_data <- sugar_data[train_indices, ]
test_data <- sugar_data[-train_indices, ]

# Linear model
sugar_model <- lm(Open_Interest.t ~ ., data = train_data)

# Stepwise model selection based on AIC
stepwise_sugar <- step(sugar_model, direction = "backward")

# Predict and evaluate the stepwise model
sugar_predict <- predict(stepwise_sugar, test_data)
mse_sugar <- mean((test_data$Open_Interest.t - predictions)^2)
r2_sugar <- summary(stepwise_sugar)$r.squared
aic_sugar <- AIC(stepwise_sugar)

# Print the MSE, R-squared, and AIC
print(paste("MSE:", mse_sugar))
print(paste("R-squared:", r2_sugar))
print(paste("AIC:", aic_sugar))

#R-squared: 0.971484189620582
#AIC: 14517.2534706176

```



```{r Cotton LM}
#Cotton lm
cotton_data <- cotton_price_cot

# Selecting predictor variables
predictor_columns_cotton <- names(cotton_data)[grepl(".t_1", names(cotton_data))]
predictor_columns_cotton <- setdiff(predictor_columns_cotton, c("Sugar.t_1", "Cocoa.t_1", "Coffee.t_1", "Sugar.t", "Cocoa.t", "Coffee.t"))
predictor_columns_cotton <- c(predictor_columns_cotton, "Cotton.t", "Cotton.t_1", "Open_Interest.t_1")

# Ensure all predictor columns are numeric
cotton_data <- cotton_data %>% select(all_of(c("Open_Interest.t", predictor_columns_cotton)))
cotton_data <- cotton_data %>% select_if(~is.numeric(.))

# Splitting the dataset in 0.7 train - 0.3 test
set.seed(42) # for reproducibility
train_indices <- sample(1:nrow(cotton_data), size = 0.7 * nrow(cotton_data))
train_data <- cotton_data[train_indices, ]
test_data <- cotton_data[-train_indices, ]

# Linear model
cotton_model <- lm(Open_Interest.t ~ ., data = train_data)

# Stepwise model selection based on AIC
stepwise_cotton <- step(cotton_model, direction = "backward")

# Predict and evaluate the stepwise model
cotton_predict <- predict(stepwise_cotton, test_data)
mse_cotton <- mean((test_data$Open_Interest.t - predictions)^2)
r2_cotton <- summary(stepwise_cotton)$r.squared
aic_cotton <- AIC(stepwise_cotton)

# Print the MSE, R-squared, and AIC
print(paste("MSE:", mse_cotton))
print(paste("R-squared:", r2_cotton))
print(paste("AIC:", aic_cotton))

#R-squared: 0.973180108288965
#AIC: 13281.2918272419


```

```{r Coffee LM}
#Coffee lm
coffee_data <- coffee_price_cot

# Selecting predictor variables
predictor_columns_coffee <- names(coffee_data)[grepl(".t_1", names(coffee_data))]
predictor_columns_coffee <- setdiff(predictor_columns_coffee, c("Sugar.t_1", "Cocoa.t_1", "Cotton.t_1", "Sugar.t", "Cocoa.t", "Cotton.t"))
predictor_columns_coffee <- c(predictor_columns_coffee, "Coffee.t", "Coffee.t_1", "Open_Interest.t_1")

# Ensure all predictor columns are numeric
coffee_data <- coffee_data %>% select(all_of(c("Open_Interest.t", predictor_columns_coffee)))
coffee_data <- coffee_data %>% select_if(~is.numeric(.))

# Splitting the dataset in 0.7 train - 0.3 test
set.seed(42) # for reproducibility
train_indices <- sample(1:nrow(coffee_data), size = 0.7 * nrow(coffee_data))
train_data <- coffee_data[train_indices, ]
test_data <- coffee_data[-train_indices, ]

# Linear model
coffee_model <- lm(Open_Interest.t ~ ., data = train_data)

# Stepwise model selection based on AIC
stepwise_coffee <- step(coffee_model, direction = "backward")

# Predict and evaluate the stepwise model
coffee_predict <- predict(stepwise_coffee, test_data)
mse_coffee <- mean((test_data$Open_Interest.t - predictions)^2)
r2_coffee <- summary(stepwise_coffee)$r.squared
aic_coffee <- AIC(stepwise_coffee)

# Print the MSE, R-squared, and AIC
print(paste("MSE:", mse_coffee))
print(paste("R-squared:", r2_coffee))
print(paste("AIC:", aic_coffee))

# R-squared: 0.987956413120843
# AIC: 12885.2839667785

```

```{r COCOA LM}
#Cocoa lm

cocoa_data <- cocoa_price_cot

# Selecting predictor variables
predictor_columns_cocoa <- names(cocoa_data)[grepl(".t_1", names(cocoa_data))]
predictor_columns_cocoa <- setdiff(predictor_columns_cocoa, c("Sugar.t_1", "Cotton.t_1", "Coffee.t_1", "Sugar.t", "Cotton.t", "Coffee.t"))
predictor_columns_cocoa <- c(predictor_columns_cocoa, "Cocoa.t", "Cocoa.t_1", "Open_Interest.t_1")

# Ensure all predictor columns are numeric
cocoa_data <- cocoa_data %>% select(all_of(c("Open_Interest.t", predictor_columns_cocoa)))
cocoa_data <- cocoa_data %>% select_if(~is.numeric(.))

# Splitting the dataset in 0.7 train - 0.3 test
set.seed(42) # for reproducibility
train_indices <- sample(1:nrow(cocoa_data), size = 0.7 * nrow(cocoa_data))
train_data <- cocoa_data[train_indices, ]
test_data <- cocoa_data[-train_indices, ]

# Linear model
cocoa_model <- lm(Open_Interest.t ~ ., data = train_data)

# Stepwise model selection based on AIC
stepwise_cocoa <- step(cocoa_model, direction = "backward")

# Predict and evaluate the stepwise model
cocoa_predict <- predict(stepwise_cocoa, test_data)
mse_cocoa <- mean((test_data$Open_Interest.t - predictions)^2)
r2_cocoa <- summary(stepwise_cocoa)$r.squared
aic_cocoa <- AIC(stepwise_cocoa)

# Print the MSE, R-squared, and AIC
print(paste("MSE:", mse_cocoa))
print(paste("R-squared:", r2_cocoa))
print(paste("AIC:", aic_cocoa))

# R-squared: 0.991989382910009
# AIC: 12812.9068477375
```

```{r SUGAR LM PCA}

```



```{r Cotton LM PCA}

```


```{r Coffee LM PCA}

```


```{r COCOA LM PCA}

```

